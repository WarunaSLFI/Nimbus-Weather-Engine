{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/wbr15/OneDrive/Desktop/weather%20app/app/api/search/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { WeatherApiSearchItem, SearchResultItem } from \"@/app/lib/types\";\r\n\r\n// Simple in-memory cache\r\nconst CACHE = new Map<string, { data: SearchResultItem[]; timestamp: number }>();\r\nconst CACHE_TTL = 10 * 60 * 1000; // 10 minutes\r\n\r\nexport async function GET(request: NextRequest) {\r\n    const { searchParams } = new URL(request.url);\r\n    const query = searchParams.get(\"q\");\r\n\r\n    if (!query || query.length < 2) {\r\n        return NextResponse.json({ results: [] });\r\n    }\r\n\r\n    // Check Cache\r\n    const cacheKey = query.toLowerCase().trim();\r\n    const cached = CACHE.get(cacheKey);\r\n    if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\r\n        return NextResponse.json({ results: cached.data });\r\n    }\r\n\r\n    const apiKey = process.env.WEATHERAPI_KEY;\r\n    if (!apiKey) {\r\n        return NextResponse.json({ error: \"Server misconfigured\" }, { status: 500 });\r\n    }\r\n\r\n    try {\r\n        const res = await fetch(\r\n            `https://api.weatherapi.com/v1/search.json?key=${apiKey}&q=${encodeURIComponent(query)}`\r\n        );\r\n\r\n        if (!res.ok) {\r\n            // If empty or error, return empty list slightly safer\r\n            return NextResponse.json({ results: [] });\r\n        }\r\n\r\n        const data: WeatherApiSearchItem[] = await res.json();\r\n\r\n        const normalized: SearchResultItem[] = data.map((item) => ({\r\n            id: item.id,\r\n            name: item.name,\r\n            region: item.region,\r\n            country: item.country,\r\n            lat: item.lat,\r\n            lon: item.lon,\r\n        }));\r\n\r\n        // Cache it\r\n        CACHE.set(cacheKey, { data: normalized, timestamp: Date.now() });\r\n\r\n        return NextResponse.json({ results: normalized });\r\n    } catch (error) {\r\n        console.error(\"Search API Error:\", error);\r\n        return NextResponse.json({ error: \"Failed to fetch search results\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAGA,yBAAyB;AACzB,MAAM,QAAQ,IAAI;AAClB,MAAM,YAAY,KAAK,KAAK,MAAM,aAAa;AAExC,eAAe,IAAI,OAAoB;IAC1C,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;IAE/B,IAAI,CAAC,SAAS,MAAM,MAAM,GAAG,GAAG;QAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS,EAAE;QAAC;IAC3C;IAEA,cAAc;IACd,MAAM,WAAW,MAAM,WAAW,GAAG,IAAI;IACzC,MAAM,SAAS,MAAM,GAAG,CAAC;IACzB,IAAI,UAAU,KAAK,GAAG,KAAK,OAAO,SAAS,GAAG,WAAW;QACrD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS,OAAO,IAAI;QAAC;IACpD;IAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;IACzC,IAAI,CAAC,QAAQ;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC9E;IAEA,IAAI;QACA,MAAM,MAAM,MAAM,MACd,CAAC,8CAA8C,EAAE,OAAO,GAAG,EAAE,mBAAmB,QAAQ;QAG5F,IAAI,CAAC,IAAI,EAAE,EAAE;YACT,sDAAsD;YACtD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS,EAAE;YAAC;QAC3C;QAEA,MAAM,OAA+B,MAAM,IAAI,IAAI;QAEnD,MAAM,aAAiC,KAAK,GAAG,CAAC,CAAC,OAAS,CAAC;gBACvD,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,IAAI;gBACf,QAAQ,KAAK,MAAM;gBACnB,SAAS,KAAK,OAAO;gBACrB,KAAK,KAAK,GAAG;gBACb,KAAK,KAAK,GAAG;YACjB,CAAC;QAED,WAAW;QACX,MAAM,GAAG,CAAC,UAAU;YAAE,MAAM;YAAY,WAAW,KAAK,GAAG;QAAG;QAE9D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAW;IACnD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiC,GAAG;YAAE,QAAQ;QAAI;IACxF;AACJ"}}]
}